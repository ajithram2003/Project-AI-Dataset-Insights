<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Analysis Results</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
	<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
	<style>
		.container { max-width: 1200px; margin: 2rem auto; }
		img.chart { width: 100%; height: auto; background: var(--card-bg); border: 1px solid var(--table-border); padding: 0.5rem; border-radius: 12px; box-shadow: var(--shadow); }
		.section { background: var(--card-bg); border: 1px solid var(--table-border); border-radius: 14px; padding: 1rem 1.25rem; box-shadow: var(--shadow); }
		.grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.1rem; }
		@media (max-width: 1000px) { .grid-2 { grid-template-columns: 1fr; } }
		.fade-in { animation: fade .45s ease both; }
		.fade-up { animation: fadeUp .6s ease both; }
		@keyframes fade { from { opacity: 0; transform: translateY(6px) } to { opacity: 1; transform: none } }
		@keyframes fadeUp { from { opacity: 0; transform: translateY(12px) } to { opacity: 1; transform: none } }
		.table-wrap { overflow-x: auto; }
		table.stats { width: 100%; border-collapse: separate; border-spacing: 0; font-size: .95rem; }
		table.stats th, table.stats td { padding: .6rem .7rem; border-bottom: 1px solid var(--table-border); }
		table.stats thead th { text-align: left; background: var(--table-head-bg); border-bottom: 2px solid var(--table-border); }
		table.stats tbody tr:nth-child(even) { background: var(--table-row-even); }
		table.stats tbody tr:hover { background: var(--table-row-hover); }
		.meta { text-align: right; color: #667; font-size: 0.85rem; margin-top: .25rem; }
		.nav { display:flex; align-items:center; justify-content:space-between; gap: .75rem; background: var(--card-bg); border:1px solid var(--table-border); border-radius:14px; padding:.8rem 1rem; box-shadow: var(--shadow); }
		.nav .left { font-weight:600; color: var(--text); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
		.nav .right { display:flex; gap:.6rem; }
		.nav .btn { display:inline-flex; align-items:center; gap:.5rem; padding:.55rem .9rem; border-radius:12px; border:1px solid #cfe0ff; background:#ebf1ff; color:#0d254c; text-decoration:none; transition: transform .12s ease, box-shadow .25s ease, background .3s ease; }
		.nav .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 22px rgba(0,0,0,0.12); }
		.nav .btn.primary { background: linear-gradient(90deg, var(--brand-accent), var(--brand-accent-2)); border-color: transparent; color:#fff; }
	</style>
</head>
<body>
	<script>
		// Persist theme from upload page
		(function(){
			const saved = localStorage.getItem('theme') || 'light';
			document.documentElement.setAttribute('data-theme', saved);
		})();
	</script>
	<main class="container">
		<div class="nav fade-in">
			<div class="left" title="{{ filename }}">{{ filename }}</div>
			<div class="right">
				<a class="btn" href="{{ url_for('index') }}">Upload Another File</a>
				<a class="btn" href="{{ url_for('download_stats') }}">Download Stats</a>
				<a class="btn primary" href="#" onclick="window.print(); return false;" title="Download AI Report">Download Report</a>
			</div>
		</div>

		<section class="section fade-in" style="margin-top:1rem;">
			<h2 class="section-title">AI Insights Summary</h2>
			<pre id="summaryText" style="white-space:pre-wrap; margin:0;">{{ summary }}</pre>
		</section>

		<section class="section fade-in" style="margin-top:1rem;">
			<h2 class="section-title">Statistical Summary</h2>
			<div class="table-wrap">
				<table class="stats">
					<thead>
						<tr>
							<th>Metric</th>
							<th>Column</th>
							<th>Value</th>
						</tr>
					</thead>
					<tbody>
						{% for row in stats_rows %}
						<tr><td>Mean</td><td>{{ row.column }}</td><td>{{ row.mean }}</td></tr>
						<tr><td>Median</td><td>{{ row.column }}</td><td>{{ row.median }}</td></tr>
						<tr><td>Mode</td><td>{{ row.column }}</td><td>{{ row.mode }}</td></tr>
						<tr><td>Std Dev</td><td>{{ row.column }}</td><td>{{ row.std }}</td></tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</section>

		<section class="section" style="margin-top:1rem;">
			<h2 class="section-title">Data Visualizations</h2>
			<div class="grid-2" id="charts">
				{% for item in images %}
				<figure class="card fade-up" style="animation-delay: {{ (loop.index0 * 0.06) | round(2) }}s;">
					<img class="chart" src="{{ item.img }}" alt="Chart {{ loop.index }}">
					<figcaption>{{ item.caption }}</figcaption>
					<div class="meta">x: {{ item.x }} | y: {{ item.y }}</div>
				</figure>
				{% endfor %}
			</div>
		</section>
	</main>

	<div class="modal" id="modal" style="display:none; position: fixed; inset:0; background: rgba(0,0,0,0.65); align-items:center; justify-content:center; z-index: 1000;"><img id="modalImg" alt="Zoomed chart" style="max-width: 95vw; max-height: 90vh; border-radius: 10px; box-shadow: 0 8px 30px rgba(0,0,0,0.5);"></div>

	<script>
		const modal = document.getElementById('modal');
		const modalImg = document.getElementById('modalImg');
		document.getElementById('charts').addEventListener('click', (e) => {
			if (e.target && e.target.matches('img.chart')) { modalImg.src = e.target.src; modal.style.display = 'flex'; }
		});
		modal.addEventListener('click', () => { modal.style.display = 'none'; modalImg.src = ''; });
	</script>
</body>
</html>
