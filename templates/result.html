<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Analysis Results</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
	<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
	<style>
		.container { max-width: 1200px; margin: 2rem auto; }
		.dashboard { display: grid; grid-template-columns: 1fr; gap: 1.25rem; }
		@media (min-width: 1000px) { .dashboard { grid-template-columns: 2fr 1fr; } }
		img.chart { width: 100%; height: auto; background: #fff; border: 1px solid #eee; padding: 0.5rem; border-radius: 12px; cursor: zoom-in; box-shadow: var(--shadow); }
		.summary { background: var(--card-bg); border: 1px solid #e2ecff; border-radius: 14px; padding: 1rem 1.25rem; box-shadow: var(--shadow); }
		.section { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 14px; padding: 1rem 1.25rem; box-shadow: var(--shadow); }
		.stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; }
		@media (max-width: 900px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
		.stat-card { background: var(--card-bg); border: 1px solid #eee; border-radius: 12px; padding: .75rem; display:flex; align-items:center; gap:.6rem; box-shadow: var(--shadow); }
		.stat-icon { width: 28px; height: 28px; border-radius: 8px; display:flex; align-items:center; justify-content:center; color:#fff; }
		.icon-blue { background: #6b8bff; }
		.icon-green { background: #2ecc71; }
		.icon-purple { background: #9b6bff; }
		.icon-orange { background: #ff9f43; }
		.meta { text-align: right; color: #667; font-size: 0.85rem; margin-top: .25rem; }
		.grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
		@media (max-width: 1000px) { .grid-2 { grid-template-columns: 1fr; } }
		.cards { display: grid; grid-template-columns: 1fr; gap: 1rem; }
		.actions { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: .8rem; }
		@media (max-width: 700px) { .actions { grid-template-columns: 1fr; } }
		.box-btn { display:block; text-align:center; padding: .9rem 1rem; border-radius: 12px; background: #f7faff; border: 1px solid #dbe7ff; box-shadow: var(--shadow); transition: transform .12s ease, box-shadow .2s ease; }
		.box-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 22px rgba(0,0,0,0.12); }
		.box-btn.blue { background: #ebf1ff; border-color: #cfe0ff; }
		.box-btn.green { background: #e8fbf0; border-color: #c9f0da; }
		.box-btn.orange { background: #fff2e4; border-color: #ffd7b0; }
		.fade-in { animation: fade .45s ease both; }
		@keyframes fade { from { opacity: 0; transform: translateY(6px) } to { opacity: 1; transform: none } }
		.header-row { display:flex; align-items:center; justify-content: space-between; gap:.75rem; flex-wrap: wrap; }
		.meta-top { color:#667; font-size:.9rem; }
	</style>
</head>
<body>
	<main class="container">
		<div class="header-row">
			<div>
				<h1 class="gradient-text fade-in">Results for {{ filename }}</h1>
				<p class="meta-top">Uploaded at {{ uploaded_at }}</p>
			</div>
			<div class="actions" style="display:flex; gap:.5rem;">
				<a class="box-btn blue" href="{{ url_for('index') }}">← Upload Another File</a>
				<a class="box-btn" href="{{ url_for('download_stats') }}">Download Stats CSV</a>
				<button onclick="window.print()" class="box-btn orange">Download Report</button>
			</div>
		</div>

		<div class="dashboard">
			<section class="summary fade-in">
				<h2>AI‑Generated Insights</h2>
				<pre id="summaryText">{{ summary }}</pre>
				<div style="text-align:right; margin-top:.5rem;"><button id="copyBtn" class="secondary">Copy summary</button></div>
			</section>

			<section class="cards fade-in">
				<div class="section">
					<h3>Statistics Summary</h3>
					<div class="stats-grid">
						{% for row in stats_rows %}
						<div class="stat-card">
							<div class="stat-icon icon-blue" title="Mean (μ)">μ</div>
							<div><div><strong>{{ row.column }}</strong></div><div>Mean: {{ row.mean }}</div></div>
						</div>
						<div class="stat-card">
							<div class="stat-icon icon-green" title="Median">M</div>
							<div><div><strong>{{ row.column }}</strong></div><div>Median: {{ row.median }}</div></div>
						</div>
						<div class="stat-card">
							<div class="stat-icon icon-purple" title="Mode">Mo</div>
							<div><div><strong>{{ row.column }}</strong></div><div>Mode: {{ row.mode }}</div></div>
						</div>
						<div class="stat-card">
							<div class="stat-icon icon-orange" title="Std Dev (σ)">σ</div>
							<div><div><strong>{{ row.column }}</strong></div><div>Std: {{ row.std }}</div></div>
						</div>
						{% endfor %}
					</div>
				</div>

				<div class="section">
					<h3>Data Preview</h3>
					<div class="card" style="padding:.5rem;">{{ preview_html|safe }}</div>
				</div>

				<div class="section">
					<h3>Schema & Data Quality</h3>
					<div class="grid-2">
						<article class="card">
							<h4>Column Types</h4>
							{{
								('<table><thead><tr><th>Column</th><th>Dtype</th></tr></thead><tbody>' +
								''.join(['<tr><td>'+r['column']+'</td><td>'+r['dtype']+'</td></tr>' for r in dtypes_rows]) +
								'</tbody></table>')|safe
							}}
						</article>
						<article class="card">
							<h4>Missing Values</h4>
							{{
								('<table><thead><tr><th>Column</th><th>Missing</th><th>Percent</th></tr></thead><tbody>' +
								''.join(['<tr><td>'+r['column']+'</td><td>'+r['missing']|string+'</td><td>'+r['missing_pct']+'</td></tr>' for r in missing_rows]) +
								'</tbody></table>')|safe
							}}
							<p style="margin-top:.5rem"><strong>Duplicate rows:</strong> {{ duplicates_count }}</p>
						</article>
					</div>
				</div>
			</section>
		</div>

		<section class="section fade-in" style="margin-top:1rem;">
			<h2>Data Visualizations</h2>
			<div class="grid-2" id="charts">
				{% for item in images %}
				<figure class="card fade-in">
					<img class="chart" src="{{ item.img }}" alt="Chart {{ loop.index }}">
					<figcaption>{{ item.caption }}</figcaption>
					<div class="meta">x: {{ item.x }} | y: {{ item.y }}</div>
				</figure>
				{% endfor %}
			</div>
		</section>

		<div class="actions" style="margin-top:1rem;">
			<a class="box-btn blue" href="{{ url_for('index') }}">← Upload Another File</a>
			<a class="box-btn" href="{{ url_for('download_stats') }}">Download Stats CSV</a>
			<button onclick="window.print()" class="box-btn orange">Download Report</button>
		</div>

		<footer style="text-align:center; margin-top:1.25rem; color:#667;">
			<p>Built for Multimeta AI Technical Assessment</p>
		</footer>
	</main>

	<div class="modal" id="modal"><img id="modalImg" alt="Zoomed chart"></div>

	<script>
		// Copy summary
		const copyBtn = document.getElementById('copyBtn');
		const summaryText = document.getElementById('summaryText');
		copyBtn.addEventListener('click', async () => {
			try { await navigator.clipboard.writeText(summaryText.textContent); copyBtn.textContent = 'Copied!'; setTimeout(() => copyBtn.textContent = 'Copy summary', 1200); }
			catch (e) { copyBtn.textContent = 'Copy failed'; setTimeout(() => copyBtn.textContent = 'Copy summary', 1200); }
		});

		// Modal zoom for charts
		const modal = document.getElementById('modal');
		const modalImg = document.getElementById('modalImg');
		document.getElementById('charts').addEventListener('click', (e) => {
			if (e.target && e.target.matches('img.chart')) { modalImg.src = e.target.src; modal.style.display = 'flex'; }
		});
		modal.addEventListener('click', () => { modal.style.display = 'none'; modalImg.src = ''; });
	</script>
</body>
</html>
